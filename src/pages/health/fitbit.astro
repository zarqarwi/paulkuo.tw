---
import BaseLayout from '../../layouts/BaseLayout.astro';
---
<BaseLayout title="Fitbit Sleep Analysis â€” Paul Kuo" description="Fitbit å–®è£ç½®ç¡çœ å¥åº·å ±å‘Šï¼ˆ33å€‹æœˆï¼‰">

<div id="authGate" class="dashboard-auth">
  <div class="auth-card">
    <h2>ğŸ”’ Health Data</h2>
    <p>è¼¸å…¥å­˜å–å¯†ç¢¼</p>
    <input type="password" id="authInput" placeholder="Password" autofocus />
    <button id="authBtn">é€²å…¥</button>
  </div>
</div>



<div id="mainContent" style="display:none" class="health-container">
  <header class="health-header">
    <div>
      <h1>ğŸ›ï¸ Paul ç¡çœ å¥åº·å ±å‘Š</h1>
      <p class="health-subtitle">Fitbit å–®è£ç½® Â· 2023/05â€“2026/02 Â· 883 å¤©ç´€éŒ„ Â· ç´„ 33 å€‹æœˆ</p>
    </div>
    <a href="/health/dual" class="health-nav-link">â†’ é›™è£ç½®æ•´åˆåˆ†æ</a>
  </header>

  <div class="health-tabs">
    <button class="tab-btn active" data-tab="0">ç¸½è¦½</button>
    <button class="tab-btn" data-tab="1">ç¡çœ æ™‚é•·</button>
    <button class="tab-btn" data-tab="2">æ•ˆç‡</button>
    <button class="tab-btn" data-tab="3">ç¡çœ éšæ®µ</button>
    <button class="tab-btn" data-tab="4">å¹´åº¦å°æ¯”</button>
  </div>

  <!-- Tab 0: ç¸½è¦½ -->
  <div class="tab-content active" data-tab="0">
    <div class="kpi-grid kpi-4col">
      <div class="kpi"><span class="kpi-label">å…¨æœŸå¹³å‡ç¡çœ </span><span class="kpi-value" style="color:var(--accent-ai)" id="kpi-avg"></span><span class="kpi-sub" id="kpi-avg-sub"></span></div>
      <div class="kpi"><span class="kpi-label">å…¨æœŸå¹³å‡æ•ˆç‡</span><span class="kpi-value" style="color:var(--accent-faith)" id="kpi-eff"></span><span class="kpi-sub">85%ä»¥ä¸Šç‚ºä½³</span></div>
      <div class="kpi"><span class="kpi-label">æœ€ä½³æœˆä»½</span><span class="kpi-value" style="color:var(--accent-circular)" id="kpi-best"></span><span class="kpi-sub" id="kpi-best-sub"></span></div>
      <div class="kpi"><span class="kpi-label">æœ€å·®æœˆä»½</span><span class="kpi-value" style="color:var(--accent-startup)" id="kpi-worst"></span><span class="kpi-sub" id="kpi-worst-sub"></span></div>
    </div>

    <div class="chart-panel full-width">
      <h3>âš¡ é—œéµç™¼ç¾</h3>
      <div class="findings-list">
        <div class="finding"><span class="dot red">â—</span><p><strong>é•·æœŸç¡çœ ä¸è¶³</strong> â€” è¿‘ 3 å¹´æ²’æœ‰ä»»ä½•æœˆä»½é”åˆ°å»ºè­°çš„ 7 å°æ™‚ã€‚æ¯å¤©ç¼ºå°‘ç´„ 1 å°æ™‚ã€‚</p></div>
        <div class="finding"><span class="dot yellow">â—</span><p><strong>2025 å¹´æ˜é¡¯æƒ¡åŒ–</strong> â€” 2023/2024 å¹³å‡ç´„ 6h02mï¼Œ2025 é™è‡³ 5h41mï¼Œå°‘äº† 21 åˆ†é˜ã€‚Q2 2025 æ˜¯æœ€ä½è°·ï¼ˆ5h16mï¼‰ã€‚</p></div>
        <div class="finding"><span class="dot orange">â—</span><p><strong>æ•ˆç‡ä¸‹æ»‘ä¸­</strong> â€” 2024 å¹´ç¶­æŒ 83-84%ï¼Œ2025 é™è‡³ 78-80%ï¼Œ2026 åˆæ›´é™è‡³ 74-75%ï¼Œåœ¨åºŠä¸Šæ¸…é†’æ™‚é–“è¶Šä¾†è¶Šå¤šã€‚</p></div>
        <div class="finding"><span class="dot blue">â—</span><p><strong>æ·±å±¤ç¡çœ è¡°é€€</strong> â€” 2023 ä¸‹åŠå¹´å¹³å‡ 65+ åˆ†é˜ï¼Œ2025 ä¸ŠåŠå¹´é©Ÿé™è‡³ 33-49 åˆ†é˜ã€‚æ·±å±¤ç¡çœ é—œä¹èº«é«”ä¿®å¾©èˆ‡è¨˜æ†¶éå›ºã€‚</p></div>
        <div class="finding"><span class="dot purple">â—</span><p><strong>è³‡æ–™æ–·å±¤</strong> â€” 2024/12~2025/01 ç„¡ç´€éŒ„ï¼Œå¯èƒ½æ›è£ç½®æˆ–æœªä½©æˆ´ã€‚</p></div>
      </div>
    </div>

    <div class="chart-panel full-width">
      <h3>ğŸ“Š å¹´åº¦è¶¨å‹¢</h3>
      <div class="chart-wrap"><canvas id="yearlyBarChart"></canvas></div>
    </div>
  </div>

  <!-- Tab 1: ç¡çœ æ™‚é•· -->
  <div class="tab-content" data-tab="1">
    <div class="chart-panel full-width">
      <h3>æ¯æœˆå¹³å‡ç¡çœ æ™‚é•·</h3>
      <div class="chart-wrap tall"><canvas id="durationChart"></canvas></div>
      <p class="chart-note">ç´…è‰²è™›ç·š = 7 å°æ™‚å»ºè­°å€¼ Â· ç´…è‰²æŸ± = ä¸è¶³ 5 å°æ™‚</p>
    </div>
    <div class="chart-panel full-width">
      <h3>å­£åº¦å¹³å‡</h3>
      <div class="chart-wrap"><canvas id="quarterChart"></canvas></div>
    </div>
  </div>

  <!-- Tab 2: æ•ˆç‡ -->
  <div class="tab-content" data-tab="2">
    <div class="chart-panel full-width">
      <h3>æ¯æœˆç¡çœ æ•ˆç‡ %</h3>
      <div class="chart-wrap tall"><canvas id="efficiencyChart"></canvas></div>
      <p class="chart-note">ç´…è‰²è™›ç·š = 85% ç†æƒ³å€¼ Â· ç´…è‰²æŸ± = ä½æ–¼ 75%</p>
    </div>
    <div class="chart-panel full-width">
      <h3>æ•ˆç‡è¶¨å‹¢åˆ†æ</h3>
      <div class="findings-list">
        <div class="finding"><span class="dot yellow">â—</span><p>2023-2024 å¹´æ•ˆç‡ç©©å®šåœ¨ <strong>81-84%</strong>ï¼Œæ³¢å‹•å°ã€‚</p></div>
        <div class="finding"><span class="dot orange">â—</span><p>2025 å¹´æ•ˆç‡é–‹å§‹ä¸‹æ»‘è‡³ <strong>78-83%</strong>ï¼Œ2026 åˆæ›´é™è‡³ <strong>74-75%</strong>ã€‚</p></div>
        <div class="finding"><span class="dot red">â—</span><p>æ•ˆç‡ä¸‹é™ + åœ¨åºŠæ™‚é–“å¢åŠ  = èººåœ¨åºŠä¸Šç¡ä¸è‘—çš„æ™‚é–“è®Šå¤šäº†ã€‚å¯èƒ½è·Ÿå°±å¯¢æ™‚é–“ä¸è¦å¾‹ã€å£“åŠ›ã€æˆ–ç¡å‰ç¿’æ…£æ”¹è®Šæœ‰é—œã€‚</p></div>
      </div>
    </div>
  </div>

  <!-- Tab 3: ç¡çœ éšæ®µ -->
  <div class="tab-content" data-tab="3">
    <div class="chart-panel full-width">
      <h3>æ·±å±¤ vs REM ç¡çœ ï¼ˆåˆ†é˜/å¤©ï¼‰</h3>
      <div class="chart-wrap tall"><canvas id="stagesChart"></canvas></div>
    </div>
    <div class="kpi-grid kpi-2col">
      <div class="kpi"><span class="kpi-label">æ·±å±¤ç¡çœ é«˜å³°</span><span class="kpi-value" style="color:var(--accent-life)">2023/09 â€” 73åˆ†</span><span class="kpi-sub">ç›®å‰ 53 åˆ†ï¼ˆâ†“27%ï¼‰</span></div>
      <div class="kpi"><span class="kpi-label">REM é«˜å³°</span><span class="kpi-value" style="color:var(--accent-ai)">2024/04 â€” 87åˆ†</span><span class="kpi-sub">ç›®å‰ 65 åˆ†ï¼ˆâ†“25%ï¼‰</span></div>
    </div>
    <div class="chart-panel full-width">
      <h3>ç¡çœ éšæ®µè§£è®€</h3>
      <div class="findings-list">
        <div class="finding"><span class="dot purple">â—</span><p><strong>æ·±å±¤ç¡çœ </strong>è² è²¬èº«é«”ä¿®å¾©ã€å…ç–«å¼·åŒ–ã€è¨˜æ†¶éå›ºã€‚å»ºè­°ä½”ç¸½ç¡çœ  13-23%ã€‚ç›®å‰ç´„ 15%ï¼Œåˆç†ä½†åä½ã€‚</p></div>
        <div class="finding"><span class="dot blue">â—</span><p><strong>REM ç¡çœ </strong>è² è²¬æƒ…ç·’è™•ç†ã€å‰µé€ åŠ›ã€å­¸ç¿’ã€‚å»ºè­°ä½” 20-25%ã€‚ç›®å‰ç´„ 20%ï¼Œå‰›å¥½åœ¨é‚Šç•Œã€‚</p></div>
        <div class="finding"><span class="dot red">â—</span><p>å…©è€…è¡°é€€ä¸»å› ï¼š<strong>ç¸½ç¡çœ æ™‚é–“ä¸è¶³</strong>ã€‚æ·±å±¤é›†ä¸­åœ¨å‰åŠå¤œã€REM é›†ä¸­åœ¨å¾ŒåŠå¤œï¼Œç¡å¤ªå°‘å…©è€…éƒ½æœƒè¢«æˆªæ–·ã€‚</p></div>
      </div>
    </div>
  </div>

  <!-- Tab 4: å¹´åº¦å°æ¯” -->
  <div class="tab-content" data-tab="4">
    <div class="chart-panel full-width">
      <h3>å¹´åº¦æ¯”è¼ƒ</h3>
      <table class="data-table">
        <thead><tr><th>å¹´ä»½</th><th>å¹³å‡ç¡çœ </th><th>æ•ˆç‡</th><th>ç´€éŒ„å¤©æ•¸</th><th>vs å‰å¹´</th></tr></thead>
        <tbody id="yearlyTable"></tbody>
      </table>
    </div>
    <div class="chart-panel full-width">
      <h3>ğŸ“‹ è³‡æ–™å“è³ªå‚™è¨»</h3>
      <div class="findings-list">
        <div class="finding"><span class="dot blue">â—</span><p>2023/05 ä½¿ç”¨ Classic æ¨¡å¼ï¼ˆèˆŠè£ç½®ï¼‰ï¼Œç„¡æ·±å±¤/REM è³‡æ–™</p></div>
        <div class="finding"><span class="dot blue">â—</span><p>2023/06 èµ·åˆ‡æ› Stages æ¨¡å¼ï¼Œæœ‰å®Œæ•´ç¡çœ éšæ®µ</p></div>
        <div class="finding"><span class="dot orange">â—</span><p>2024/12 ~ 2025/01 ç„¡è³‡æ–™ï¼ˆå¯èƒ½æœªä½©æˆ´æˆ–æ›è£ç½®ï¼‰</p></div>
        <div class="finding"><span class="dot blue">â—</span><p>2026 è³‡æ–™åƒ…åˆ° 2/19ï¼Œå°šä¸å®Œæ•´</p></div>
      </div>
    </div>
    <div class="chart-panel full-width action-box">
      <h3>ğŸ’¡ å»ºè­°è¡Œå‹•</h3>
      <div class="findings-list">
        <div class="finding"><span class="dot green">â—</span><p><strong>è¨­å®šå›ºå®šå°±å¯¢æ™‚é–“</strong> â€” å…¥ç¡æ™‚é–“æ³¢å‹•æ¥µå¤§ï¼Œç©©å®šä½œæ¯æ˜¯æ”¹å–„çš„ç¬¬ä¸€æ­¥ã€‚</p></div>
        <div class="finding"><span class="dot green">â—</span><p><strong>å…ˆè¿½æ±‚ 6.5 å°æ™‚</strong> â€” å¾ç¾åœ¨çš„ 5h ç›´æ¥è·³åˆ° 7h ä¸åˆ‡å¯¦éš›ï¼Œå…ˆä»¥ 6.5h ç‚ºç›®æ¨™ã€‚</p></div>
        <div class="finding"><span class="dot green">â—</span><p><strong>ç•™æ„æ•ˆç‡æŒçºŒä¸‹æ»‘</strong> â€” 2026 å¹´æ•ˆç‡é™åˆ° 74%ï¼Œå¯èƒ½éœ€è¦æª¢è¦–ç¡å‰è¢å¹•ä½¿ç”¨ã€å’–å•¡å› æ”å–æ™‚é–“ã€‚</p></div>
        <div class="finding"><span class="dot green">â—</span><p><strong>å–„ç”¨ Claude è¿½è¹¤</strong> â€” æ¯é€±æ‹‰æ•¸æ“šåš weekly reviewï¼ŒæŒçºŒç›£æ§æ”¹å–„é€²åº¦ã€‚</p></div>
      </div>
    </div>
  </div>
</div>

<script is:inline src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script is:inline>
// Tabs
document.querySelectorAll('.tab-btn').forEach(b => {
  b.onclick = () => {
    document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    document.querySelector('.tab-content[data-tab="'+b.dataset.tab+'"]').classList.add('active');
  };
});

const MONTHLY = [
  {month:"2023-05",days:21,avgSleep:363,avgInBed:391,eff:93,deep:null,rem:null},
  {month:"2023-06",days:30,avgSleep:334,avgInBed:401,eff:84,deep:54,rem:65},
  {month:"2023-07",days:31,avgSleep:385,avgInBed:464,eff:83,deep:65,rem:72},
  {month:"2023-08",days:31,avgSleep:368,avgInBed:457,eff:81,deep:63,rem:68},
  {month:"2023-09",days:30,avgSleep:348,avgInBed:420,eff:83,deep:73,rem:68},
  {month:"2023-10",days:30,avgSleep:359,avgInBed:443,eff:81,deep:68,rem:65},
  {month:"2023-11",days:28,avgSleep:379,avgInBed:460,eff:82,deep:67,rem:72},
  {month:"2023-12",days:31,avgSleep:367,avgInBed:455,eff:81,deep:66,rem:71},
  {month:"2024-01",days:31,avgSleep:385,avgInBed:471,eff:82,deep:67,rem:75},
  {month:"2024-02",days:29,avgSleep:350,avgInBed:428,eff:82,deep:56,rem:78},
  {month:"2024-03",days:31,avgSleep:364,avgInBed:440,eff:83,deep:66,rem:84},
  {month:"2024-04",days:29,avgSleep:372,avgInBed:455,eff:82,deep:63,rem:87},
  {month:"2024-05",days:31,avgSleep:335,avgInBed:410,eff:82,deep:57,rem:70},
  {month:"2024-06",days:30,avgSleep:372,avgInBed:445,eff:84,deep:54,rem:87},
  {month:"2024-07",days:31,avgSleep:358,avgInBed:429,eff:83,deep:66,rem:69},
  {month:"2024-08",days:29,avgSleep:359,avgInBed:430,eff:84,deep:66,rem:71},
  {month:"2024-09",days:30,avgSleep:367,avgInBed:439,eff:84,deep:69,rem:82},
  {month:"2024-10",days:31,avgSleep:359,avgInBed:427,eff:84,deep:58,rem:78},
  {month:"2024-11",days:20,avgSleep:355,avgInBed:425,eff:84,deep:64,rem:70},
  {month:"2025-02",days:7,avgSleep:305,avgInBed:369,eff:83,deep:33,rem:71},
  {month:"2025-03",days:29,avgSleep:352,avgInBed:436,eff:81,deep:43,rem:73},
  {month:"2025-04",days:29,avgSleep:326,avgInBed:394,eff:83,deep:46,rem:77},
  {month:"2025-05",days:23,avgSleep:303,avgInBed:369,eff:82,deep:49,rem:69},
  {month:"2025-06",days:17,avgSleep:316,avgInBed:384,eff:82,deep:58,rem:81},
  {month:"2025-07",days:30,avgSleep:326,avgInBed:416,eff:79,deep:66,rem:65},
  {month:"2025-08",days:25,avgSleep:309,avgInBed:388,eff:80,deep:64,rem:66},
  {month:"2025-09",days:29,avgSleep:365,avgInBed:465,eff:79,deep:65,rem:82},
  {month:"2025-10",days:31,avgSleep:364,avgInBed:467,eff:78,deep:56,rem:77},
  {month:"2025-11",days:28,avgSleep:371,avgInBed:473,eff:79,deep:56,rem:78},
  {month:"2025-12",days:31,avgSleep:366,avgInBed:467,eff:79,deep:59,rem:87},
  {month:"2026-01",days:31,avgSleep:357,avgInBed:480,eff:74,deep:56,rem:76},
  {month:"2026-02",days:19,avgSleep:299,avgInBed:400,eff:75,deep:53,rem:65},
];

const YEARLY = [
  {year:"2023",avgSleep:363,eff:83,days:232},
  {year:"2024",avgSleep:362,eff:83,days:322},
  {year:"2025",avgSleep:341,eff:80,days:279},
  {year:"2026*",avgSleep:335,eff:75,days:50},
];

const QUARTERS = [
  {q:"2023 Q2",avg:346},{q:"2023 Q3",avg:367},{q:"2023 Q4",avg:368},
  {q:"2024 Q1",avg:367},{q:"2024 Q2",avg:359},{q:"2024 Q3",avg:361},
  {q:"2024 Q4",avg:357},{q:"2025 Q1",avg:343},{q:"2025 Q2",avg:316},
  {q:"2025 Q3",avg:334},{q:"2025 Q4",avg:367},{q:"2026 Q1",avg:335},
];

function fmt(mins){ return Math.floor(mins/60)+'h'+String(Math.round(mins%60)).padStart(2,'0')+'m'; }

// Light theme chart defaults
const textColor = '#5A5A5A';
const gridColor = 'rgba(0,0,0,0.06)';
const chartOpts = {
  responsive:true,
  maintainAspectRatio:false,
  plugins:{
    legend:{labels:{color:textColor, font:{family:'DM Sans, Noto Sans TC, sans-serif'}}},
  },
  scales:{
    x:{ticks:{color:textColor,maxRotation:45,font:{size:11}},grid:{color:gridColor}},
    y:{ticks:{color:textColor,font:{size:11}},grid:{color:gridColor}}
  }
};

function initAll(){
  const totalSleep = MONTHLY.reduce((a,d)=>a+d.avgSleep*d.days,0);
  const totalDays = MONTHLY.reduce((a,d)=>a+d.days,0);
  const totalEff = MONTHLY.reduce((a,d)=>a+d.eff*d.days,0);
  const avg = totalSleep/totalDays;
  const avgEff = totalEff/totalDays;
  const best = MONTHLY.reduce((a,d)=>d.avgSleep>a.avgSleep?d:a);
  const worst = MONTHLY.reduce((a,d)=>d.avgSleep<a.avgSleep?d:a);

  document.getElementById('kpi-avg').textContent = fmt(avg);
  document.getElementById('kpi-avg-sub').textContent = 'å»ºè­° 7h+ | çŸ­ç¼º '+fmt(420-avg)+'/å¤©';
  document.getElementById('kpi-eff').textContent = avgEff.toFixed(0)+'%';
  document.getElementById('kpi-best').textContent = best.month;
  document.getElementById('kpi-best-sub').textContent = fmt(best.avgSleep);
  document.getElementById('kpi-worst').textContent = worst.month;
  document.getElementById('kpi-worst-sub').textContent = fmt(worst.avgSleep);

  const tbody = document.getElementById('yearlyTable');
  YEARLY.forEach((y,i) => {
    const diff = i>0 ? y.avgSleep-YEARLY[i-1].avgSleep : 0;
    const diffColor = diff>0?'#059669':diff<0?'#DC2626':'#8A8A8A';
    const diffText = i===0?'â€”':(diff>0?'+':'')+diff+'åˆ†';
    tbody.innerHTML += '<tr><td>'+y.year+'</td><td>'+fmt(y.avgSleep)+'</td><td>'+y.eff+'%</td><td>'+y.days+'</td><td style="color:'+diffColor+'">'+diffText+'</td></tr>';
  });

  // Yearly bar chart
  new Chart(document.getElementById('yearlyBarChart'),{type:'bar',data:{labels:YEARLY.map(y=>y.year),datasets:[{label:'å¹³å‡ç¡çœ (åˆ†)',data:YEARLY.map(y=>y.avgSleep),backgroundColor:YEARLY.map(y=>y.avgSleep>=360?'#2563EB':'#B45309'),borderRadius:6}]},options:{...chartOpts,scales:{...chartOpts.scales,y:{...chartOpts.scales.y,min:300,max:430,ticks:{...chartOpts.scales.y.ticks,callback:v=>fmt(v)}}}}});

  // Duration chart
  new Chart(document.getElementById('durationChart'),{type:'bar',data:{labels:MONTHLY.map(d=>d.month.slice(2)),datasets:[{label:'å¹³å‡ç¡çœ (åˆ†)',data:MONTHLY.map(d=>d.avgSleep),backgroundColor:MONTHLY.map(d=>d.avgSleep<300?'#DC2626':'#2563EB'),borderRadius:4}]},options:{...chartOpts,scales:{...chartOpts.scales,y:{...chartOpts.scales.y,min:250,max:420,ticks:{...chartOpts.scales.y.ticks,callback:v=>fmt(v)}}}}});

  // Quarter chart
  new Chart(document.getElementById('quarterChart'),{type:'bar',data:{labels:QUARTERS.map(q=>q.q),datasets:[{label:'å­£åº¦å¹³å‡(åˆ†)',data:QUARTERS.map(q=>q.avg),backgroundColor:QUARTERS.map(q=>q.avg>=360?'#2563EB':q.avg>=320?'#B45309':'#DC2626'),borderRadius:6}]},options:{...chartOpts,scales:{...chartOpts.scales,y:{...chartOpts.scales.y,min:280,max:400,ticks:{...chartOpts.scales.y.ticks,callback:v=>fmt(v)}}}}});

  // Efficiency chart
  new Chart(document.getElementById('efficiencyChart'),{type:'bar',data:{labels:MONTHLY.map(d=>d.month.slice(2)),datasets:[{label:'æ•ˆç‡%',data:MONTHLY.map(d=>d.eff),backgroundColor:MONTHLY.map(d=>d.eff<75?'#DC2626':'#B45309'),borderRadius:4}]},options:{...chartOpts,scales:{...chartOpts.scales,y:{...chartOpts.scales.y,min:70,max:100}}}});

  // Stages chart
  const stageData = MONTHLY.filter(d=>d.deep!=null);
  new Chart(document.getElementById('stagesChart'),{type:'bar',data:{labels:stageData.map(d=>d.month.slice(2)),datasets:[{label:'æ·±å±¤',data:stageData.map(d=>d.deep),backgroundColor:'#7C3AED',borderRadius:4},{label:'REM',data:stageData.map(d=>d.rem),backgroundColor:'#2563EB',borderRadius:4}]},options:{...chartOpts,scales:{...chartOpts.scales,y:{...chartOpts.scales.y,min:0,max:100}}}});
}

initAll();
</script>

<style>
  .health-container {
    max-width: 960px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
  }

  .health-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
  }
  .health-header h1 {
    color: var(--brand-navy);
    font-family: var(--font-cjk);
    font-size: 1.6rem;
    margin: 0;
    font-weight: 700;
  }
  .health-subtitle {
    color: var(--text-muted);
    font-size: 0.85rem;
    margin-top: 0.35rem;
  }
  .health-nav-link {
    color: var(--accent-ai);
    text-decoration: none;
    font-size: 0.85rem;
    padding: 0.5rem 1rem;
    border: 1px solid var(--border);
    border-radius: 8px;
    white-space: nowrap;
    transition: all 0.2s;
  }
  .health-nav-link:hover {
    background: rgba(37,99,235,0.04);
    border-color: var(--accent-ai);
  }

  /* Tabs */
  .health-tabs {
    display: flex;
    gap: 0.35rem;
    margin-bottom: 2rem;
    overflow-x: auto;
    padding-bottom: 0.25rem;
  }
  .tab-btn {
    background: var(--bg-section);
    color: var(--text-secondary);
    border: 1px solid var(--border-light);
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
    font-family: var(--font-cjk);
    white-space: nowrap;
    transition: all 0.2s;
  }
  .tab-btn:hover {
    background: var(--bg-card);
    border-color: var(--border);
    color: var(--brand-navy);
  }
  .tab-btn.active {
    background: var(--brand-navy);
    color: #fff;
    border-color: var(--brand-navy);
  }
  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* KPI Cards */
  .kpi-grid { display: grid; gap: 1rem; margin-bottom: 1.5rem; }
  .kpi-4col { grid-template-columns: repeat(4, 1fr); }
  .kpi-2col { grid-template-columns: repeat(2, 1fr); }
  .kpi {
    background: var(--bg-card);
    padding: 1.25rem;
    border-radius: var(--radius);
    border: 1px solid var(--border-light);
    transition: all 0.2s;
  }
  .kpi:hover {
    box-shadow: var(--shadow-sm);
  }
  .kpi-label {
    display: block;
    color: var(--text-muted);
    font-size: 0.75rem;
    font-weight: 500;
    margin-bottom: 0.35rem;
  }
  .kpi-value {
    display: block;
    font-size: 1.25rem;
    font-weight: 700;
    font-family: var(--font-cjk);
  }
  .kpi-sub {
    display: block;
    color: var(--text-muted);
    font-size: 0.72rem;
    margin-top: 0.3rem;
  }

  /* Chart Panels */
  .chart-panel {
    background: var(--bg-card);
    padding: 1.5rem;
    border-radius: var(--radius);
    border: 1px solid var(--border-light);
    margin-bottom: 1rem;
  }
  .chart-panel:hover {
    box-shadow: var(--shadow-sm);
  }
  .chart-panel h3 {
    color: var(--brand-navy);
    font-size: 0.95rem;
    font-family: var(--font-cjk);
    font-weight: 700;
    margin: 0 0 1rem;
  }
  .chart-wrap { position: relative; height: 250px; }
  .chart-wrap.tall { height: 300px; }
  .chart-note {
    color: var(--text-muted);
    font-size: 0.75rem;
    margin-top: 0.75rem;
  }
  .full-width { width: 100%; }

  /* Findings */
  .findings-list {
    display: flex;
    flex-direction: column;
    gap: 0.85rem;
  }
  .finding {
    display: flex;
    gap: 0.6rem;
    font-size: 0.88rem;
    color: var(--text-secondary);
    line-height: 1.65;
    font-family: var(--font-cjk);
  }
  .finding strong {
    font-weight: 600;
    color: var(--text-primary);
  }
  .dot {
    flex-shrink: 0;
    margin-top: 0.3rem;
    font-size: 0.7rem;
  }
  .dot.red { color: #DC2626; }
  .dot.yellow { color: #B45309; }
  .dot.orange { color: #EA580C; }
  .dot.blue { color: #2563EB; }
  .dot.purple { color: #7C3AED; }
  .dot.green { color: #059669; }

  /* Action Box */
  .action-box {
    background: linear-gradient(135deg, rgba(5,150,105,0.03), rgba(37,99,235,0.03));
    border-color: rgba(5,150,105,0.2);
  }

  /* Data Table */
  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.88rem;
    font-family: var(--font-cjk);
  }
  .data-table th {
    text-align: left;
    color: var(--text-muted);
    padding: 0.6rem 0.75rem;
    border-bottom: 1px solid var(--border);
    font-size: 0.78rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.04em;
  }
  .data-table td {
    padding: 0.6rem 0.75rem;
    color: var(--text-primary);
    border-bottom: 1px solid var(--border-light);
  }
  .data-table tr:hover td {
    background: var(--bg-section);
  }

  @media (max-width: 768px) {
    .kpi-4col { grid-template-columns: repeat(2, 1fr); }
    .kpi-2col { grid-template-columns: 1fr; }
    .health-header { flex-direction: column; }
    .health-container { padding: 1rem; }
  }
</style>


<script is:inline>
// Auth gate - same as dashboard
const DASH_KEY = 'paulkuo2026';
const authGate = document.getElementById('authGate');
const mainEl = document.getElementById('mainContent') || document.getElementById('healthMain');
const authInput = document.getElementById('authInput');
const authBtn = document.getElementById('authBtn');

function checkAuth() {
  const urlKey = new URLSearchParams(window.location.search).get('key');
  const stored = sessionStorage.getItem('dash_auth');
  if (urlKey === DASH_KEY || stored === DASH_KEY) {
    sessionStorage.setItem('dash_auth', DASH_KEY);
    authGate.style.display = 'none';
    mainEl.style.display = 'block';
    return;
  }
}
checkAuth();

authBtn.addEventListener('click', () => {
  if (authInput.value === DASH_KEY) {
    sessionStorage.setItem('dash_auth', DASH_KEY);
    authGate.style.display = 'none';
    mainEl.style.display = 'block';
  } else {
    authInput.style.borderColor = '#ef4444';
    authInput.value = '';
    authInput.placeholder = 'å¯†ç¢¼éŒ¯èª¤';
  }
});
authInput.addEventListener('keydown', e => { if (e.key === 'Enter') authBtn.click(); });
</script>


<style is:global>
  .dashboard-auth {
    display: flex; justify-content: center; align-items: center;
    min-height: 60vh; padding: 2rem;
  }
  .auth-card {
    text-align: center; background: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--radius-lg); padding: 3rem; max-width: 360px; width: 100%;
    box-shadow: var(--shadow-md);
  }
  .auth-card h2 { font-family: var(--font-display); font-size: 1.5rem; margin-bottom: 0.5rem; }
  .auth-card p { color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem; }
  .auth-card input {
    width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--border);
    border-radius: 8px; font-size: 1rem; text-align: center;
    background: var(--bg); transition: border-color 0.2s;
  }
  .auth-card input:focus { outline: none; border-color: var(--brand-navy); }
  .auth-card button {
    margin-top: 1rem; width: 100%; padding: 0.75rem;
    background: var(--brand-navy); color: white; border: none;
    border-radius: 8px; font-size: 0.95rem; cursor: pointer;
    transition: background 0.2s;
  }
  .auth-card button:hover { background: var(--brand-navy-light); }
</style>

</BaseLayout>
