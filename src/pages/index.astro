---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { PILLAR_MAP, SITE } from '../config';
import feedJson from '../data/feed.json';
import CostAnalytics from '../components/CostAnalytics.astro';
import { calcReadingTime } from '../utils/readingTime';
const feedData = feedJson.items || [];

// Always show latest 3 articles (no featured filter)
const articles = (await getCollection('articles', ({ data, id }) => !data.draft && !id.startsWith('en/') && !id.startsWith('ja/') && !id.startsWith('zh-cn/')))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .slice(0, 3);

const homeSchema = JSON.stringify({
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebSite",
      "@id": `${SITE.url}/#website`,
      "url": SITE.url,
      "name": "Paul Kuo",
      "description": SITE.description,
      "inLanguage": ["zh-Hant", "en", "ja", "zh-Hans"],
      "publisher": { "@id": `${SITE.url}/#person` }
    },
    {
      "@type": "Person",
      "@id": `${SITE.url}/#person`,
      "name": SITE.author,
      "alternateName": SITE.authorAlt,
      "url": SITE.url,
      "description": SITE.description,
      "jobTitle": "Circular Economy & AI Strategy Consultant",
      "image": "https://paulkuo.tw/paul-photo.png",
      "knowsAbout": ["Circular Economy", "AI Systems", "Semiconductor Cooperation", "Theology", "Startup Strategy", "Urban Mining", "PCB Metal Recovery", "Agentic SEO", "Taiwan-Japan Business"],
      "alumniOf": ["AppWorks"],
      "nationality": { "@type": "Country", "name": "Taiwan" },
      "sameAs": [
        "https://www.linkedin.com/in/paulkuo",
        "https://x.com/zarqarwi",
        "https://www.threads.net/@zarqarwi",
        "https://www.youtube.com/@kuopaul8265",
        "https://www.facebook.com/guo.yao.lang.2025",
        "https://www.instagram.com/zarqarwi",
        "https://bsky.app/profile/paulkuo.bsky.social"
      ]
    }
  ]
});
---
<BaseLayout title={SITE.title} schemaJson={homeSchema} showTicker={true}>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-inner">
      <div class="hero-text">
        <h1 class="animate-in">Rebuilding <em>Order</em><br>in an Age of<br>Intelligence</h1>
        <p class="hero-identity animate-in delay-1">éƒ­æ›œéƒ Paul Kuo</p>
        <p class="hero-domain animate-in delay-1">é—œå¿ƒç”¢æ¥­çµæ§‹é‡æ§‹ï½œå¾ªç’°ç¶“æ¿Ÿ Ã— AI Ã— å°æ—¥æ©‹æ¥</p>
        <p class="hero-tagline animate-in delay-2">æˆ‘å°ˆæ³¨æ–¼ä¸€ä»¶äº‹ï¼šåœ¨èˆŠç§©åºé¬†å‹•çš„æ™‚ä»£ï¼Œè¨­è¨ˆä¸‹ä¸€å€‹èƒ½é‹ä½œçš„ç³»çµ±ã€‚</p>
        <p class="hero-bio animate-in delay-2">æ©«è·¨ç¥å­¸æ€è¾¨ã€æ–°å‰µç”Ÿæ…‹èˆ‡å¾ªç’°ç¶“æ¿Ÿå¯¦å‹™ï¼Œæˆ‘é•·æœŸåƒèˆ‡ä¼æ¥­è½‰å‹èˆ‡è·¨åœ‹åˆä½œå°ˆæ¡ˆï¼Œæ•´åˆæŠ€è¡“ã€è³‡æœ¬èˆ‡ç”¢æ¥­è³‡æºï¼Œæ¨å‹•å¯æŒçºŒä¸”å¯è½åœ°çš„çµæ§‹ã€‚</p>
        <div class="hero-pillars animate-in delay-3">
          <span class="pillar-tag"><span class="pillar-dot" style="background:var(--accent-ai)"></span><span>æ™ºèƒ½èˆ‡ç§©åº</span></span>
          <span class="pillar-tag"><span class="pillar-dot" style="background:var(--accent-circular)"></span><span>å¾ªç’°å†åˆ©ç”¨</span></span>
          <span class="pillar-tag"><span class="pillar-dot" style="background:var(--accent-faith)"></span><span>æ–‡æ˜èˆ‡äººæ€§</span></span>
          <span class="pillar-tag"><span class="pillar-dot" style="background:var(--accent-startup)"></span><span>å‰µé€ èˆ‡å»ºæ§‹</span></span>
          <span class="pillar-tag"><span class="pillar-dot" style="background:var(--accent-life)"></span><span>æ²‰æ€èˆ‡è¨˜æ†¶</span></span>
        </div>
        <div class="hero-actions animate-in delay-4">
          <a href="/blog" class="btn-primary">é–±è®€æ€æƒ³</a>
          <a href="/about" class="btn-secondary">èªè­˜ Paul</a>
        </div>
      </div>
    </div>
  </section>

  <!-- MANIFESTO -->
  <section class="manifesto">
    <div class="manifesto-inner">
      <div class="manifesto-kicker">å“²å­¸å®£è¨€</div>
      <p class="manifesto-quote">"é“å¿…é ˆæˆç‚ºè‚‰èº«ï¼Œç§©åºå¿…é ˆé€²å…¥ç¾å ´ã€‚"</p>
      <p class="manifesto-body">åœç•™åœ¨æ¦‚å¿µä¸­çš„ç§©åºåªæ˜¯è«–è¿°ï¼Œå”¯æœ‰é€²å…¥çœŸå¯¦çš„ç”¢æ¥­èˆ‡äººéš›é—œä¿‚ï¼Œç§©åºæ‰èƒ½è¢«é‡å»ºã€‚æŠ€è¡“å¿…é ˆè½åœ°ã€æ™ºèƒ½å¿…é ˆå…¥ä¸–â€”â€”é€™æ˜¯ä¸€å€‹ç¥å­¸è¨“ç·´å‡ºèº«çš„å‰µæ¥­è€…ï¼Œå°ã€Œé“æˆè‚‰èº«ã€æœ€å‹™å¯¦çš„ç†è§£ã€‚</p>
      <a href="/about" class="manifesto-cta">å®Œæ•´æ•…äº‹ â†’</a>
    </div>
  </section>

  <!-- LATEST THINKING -->
  <section class="section-container" aria-labelledby="section-latest-heading">
    <div class="section-header">
      <h2 class="section-title" id="section-latest-heading">æœ€æ–°æ€è€ƒ</h2>
      <a href="/blog" class="section-link">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
    </div>
    <div class="content-grid">
      {articles.length > 0 ? articles.map((article) => {
        const p = PILLAR_MAP[article.data.pillar];
        const dateStr = article.data.date.toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit' });
        return (
          <article>
            <a href={`/articles/${article.id.replace(/\.md$/, "")}`} class={`content-card ${article.data.cover ? 'has-cover' : ''}`}>
              {article.data.cover && (
                <div class="card-cover">
                  <img src={article.data.cover} alt={article.data.title} width="1792" height="1024" loading="lazy" />
                </div>
              )}
              <div class="content-card-category" style={`color:${p.color}`}>
                <span class="pillar-dot" style={`background:${p.color}`}></span> {p.label}
              </div>
              <h3>{article.data.title}</h3>
              <p>{article.data.description}</p>
              <div class="content-card-footer">
                <span>{dateStr}</span>
                {(() => { const rt = calcReadingTime(article.body || ''); return rt > 0 ? <span class="reading-time">Â· ç´„ {rt} åˆ†é˜</span> : null; })()}
                {article.data.platform && <span class="platform-badge">{article.data.platform}</span>}
              </div>
            </a>
          </article>
        );
      }) : (
        <>
          <div class="content-card" style="opacity:0.6; pointer-events:none;">
            <div class="content-card-category" style="color:var(--accent-faith)">
              <span class="pillar-dot" style="background:var(--accent-faith)"></span> æ–‡æ˜èˆ‡äººæ€§
            </div>
            <h3>é“æˆè‚‰èº«ä¹‹å¿…è¦æ€§ï¼šç‚ºäººå·¥æ™ºæ…§çš„å…·èº«ç™¼å±•æä¾›å“²å­¸è«–è­‰</h3>
            <p>AI çš„æ ¸å¿ƒç¼ºé™·ä¸æ˜¯æŠ€è¡“æ€§çš„ï¼Œè€Œæ˜¯å­˜æœ‰è«–å±¤æ¬¡çš„ã€‚ä»£ç¢¼ä¹‹é“ï¼Œå¿…é ˆæˆç‚ºè‚‰èº«ã€‚</p>
            <div class="content-card-footer"><span>2025.10</span><span class="platform-badge">è«–æ–‡</span></div>
          </div>
          <div class="content-card" style="opacity:0.6; pointer-events:none;">
            <div class="content-card-category" style="color:var(--accent-ai)">
              <span class="pillar-dot" style="background:var(--accent-ai)"></span> æ™ºèƒ½èˆ‡ç§©åº
            </div>
            <h3>ç…¤ç¤¦è£¡çš„é‡‘çµ²é›€ï¼šAI å°±æ¥­è¡æ“Šçš„é è­¦ç³»çµ±</h3>
            <p>AI ä¸æ˜¯æœªä¾†æ‰æœƒæ¶å·¥ä½œï¼Œå®ƒå·²ç¶“åœ¨æ¶äº†ã€‚å•é¡Œæ˜¯æˆ‘å€‘æœ‰æ²’æœ‰çœ‹æ‡‚å“ªäº›è¨Šè™Ÿã€‚</p>
            <div class="content-card-footer"><span>2025.10</span><span class="platform-badge">Medium</span></div>
          </div>
          <div class="content-card" style="opacity:0.6; pointer-events:none;">
            <div class="content-card-category" style="color:var(--accent-startup)">
              <span class="pillar-dot" style="background:var(--accent-startup)"></span> å‰µé€ èˆ‡å»ºæ§‹
            </div>
            <h3>å‰µæ¥­åäºŒå¹´ï¼šå‹æƒ…ã€å …æŒèˆ‡æœªçŸ¥çš„æ—…ç¨‹</h3>
            <p>ä¸æ˜¯å‰µæ¥­çš„æˆæœè®“æˆ‘å€‘æœ‰åŠ›é‡ï¼Œè€Œæ˜¯å‰µæ¥­ç²¾ç¥æœ¬èº«æœ‰åŠ›é‡ã€‚</p>
            <div class="content-card-footer"><span>2023.06</span><span class="platform-badge">Facebook</span></div>
          </div>
        </>
      )}
    </div>
  </section>

  <!-- PROJECTS -->
  <section style="background:var(--bg-section)" aria-labelledby="section-projects-heading">
    <div class="section-container">
      <div class="section-header">
        <h2 class="section-title" id="section-projects-heading">å°ˆæ¡ˆ</h2>
        <a href="/projects" class="section-link">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
      </div>
      <div class="projects-grid">
        <a href="/projects" class="project-card circleflow" style="text-decoration:none;color:inherit">
          <div class="project-icon" style="background:rgba(5,150,105,0.1)">â™»ï¸</div>
          <h3>CircleFlow</h3>
          <p>å¾ªç’°ç¶“æ¿Ÿçš„æ•¸æ“šåŸºç¤è¨­æ–½ï¼Œè®“è³‡æºçš„æµå‘ã€åƒ¹å€¼èˆ‡æ­¸å±¬é‡æ–°å¯è¦‹ã€å¯è¿½è¹¤ã€å¯æ²»ç†ã€‚</p>
          <div class="project-tags">
            <span class="project-tag">å¾ªç’°å†åˆ©ç”¨</span>
            <span class="project-tag">AI</span>
            <span class="project-tag">Platform</span>
          </div>
          <span class="project-cta">äº†è§£æ›´å¤š â†’</span>
        </a>
        <a href="/projects" class="project-card debate" style="text-decoration:none;color:inherit">
          <div class="project-icon" style="background:rgba(37,99,235,0.1)">ğŸ§ </div>
          <h3>å¤šæ¨¡å‹èªçŸ¥å”ä½œæ¡†æ¶</h3>
          <p>ç•¶å€‹é«”å¿…é ˆåœ¨è³‡è¨Šéè¼‰ä¸­åšå‡ºåˆ¤æ–·ï¼Œä»€éº¼æ¨£çš„èªçŸ¥çµæ§‹èƒ½æä¾›æ›´å¯é çš„æ€è€ƒæ”¯æ’ã€‚</p>
          <div class="project-tags">
            <span class="project-tag">Multi-Agent</span>
            <span class="project-tag">èªçŸ¥åŸºç¤è¨­æ–½</span>
          </div>
          <span class="project-cta">äº†è§£æ›´å¤š â†’</span>
        </a>
      </div>
    </div>
  </section>

  <!-- SOCIAL FEED -->
  <section class="section-container" id="feed" aria-labelledby="section-feed-heading">
    <div class="section-header">
      <h2 class="section-title" id="section-feed-heading">å‹•æ…‹æƒ…å ±</h2>
    </div>
    <!-- COST ANALYTICS -->
    <CostAnalytics />
    <p style="color:var(--text-secondary); margin-bottom:32px;">ä¾†è‡ª 7 å€‹å¹³å°çš„å³æ™‚å‹•æ…‹ã€‚</p>
    <div class="feed-grid">
      {feedData.length > 0 ? feedData.slice(0, 8).map((item) => {
        const dtParts = item.datetime.replace(/[-:\/]/g, ' ').split(' ');
        const isoDate = dtParts.length >= 5 
          ? `${dtParts[0]}-${dtParts[1]}-${dtParts[2]}T${dtParts[3]}:${dtParts[4]}:00+08:00`
          : item.datetime;
        const displayDate = item.datetime.replace(/-/g, '.').substring(0, 16);
        const excerpt = item.content.split('\n')[0].substring(0, 200);
        return (
          <article class="feed-item">
            <header class="feed-header">
              <span class="feed-platform" style={`color:${item.color}`}>{item.platform}</span>
              <time class="feed-date" datetime={isoDate}>{displayDate}</time>
            </header>
            <div class="prose"><p>{excerpt}</p></div>
          </article>
        );
      }) : (
        <p style="color:var(--text-secondary)">æš«ç„¡å‹•æ…‹ã€‚</p>
      )}
    </div>
  </section>

  <!-- CONTACT -->
  <section class="contact-section" id="contact" aria-label="è¯çµ¡ Paul Kuo" role="complementary">
    <div class="section-container">
      <div class="contact-grid">
        <div class="contact-text">
          <h2>ä¸€èµ·æ‰“é€ <br>æœ‰æ„ç¾©çš„äº‹</h2>
          <p>ç„¡è«–ä½ æ˜¯åœ¨æ€è€ƒå¦‚ä½•è®“æŠ€è¡“å›åˆ°äººæ€§èˆ‡ç§©åºçš„å¯¦ä½œå ´æ™¯ã€æƒ³æ·±åŒ–å¾ªç’°å†ç”Ÿæœå‹™èˆ‡æ¶æ§‹å¸ƒå±€ã€æˆ–å¸Œæœ›æ¢ç´¢å°æ—¥è·¨å¢ƒåˆä½œçš„å¯èƒ½ï¼Œ<br>éƒ½æ­¡è¿ä¾†ä¿¡ä¸€èµ·å°è©±ã€æ¿€ç›ªæˆ–åˆä½œã€‚</p>
          <div class="social-links">
            <a href="https://x.com/zarqarwi" class="social-link" target="_blank" rel="noopener" aria-label="Paul Kuo çš„ X (Twitter) å¸³è™Ÿ">ğ• Twitter</a>
            <a href="https://www.linkedin.com/in/paulkuo" class="social-link" target="_blank" rel="noopener" aria-label="Paul Kuo çš„ LinkedIn å€‹äººæª”æ¡ˆ">in LinkedIn</a>
            <a href="https://www.threads.net/@zarqarwi" class="social-link" target="_blank" rel="noopener" aria-label="Paul Kuo çš„ Threads å¸³è™Ÿ">â—‰ Threads</a>
            <a href="https://www.youtube.com/@kuopaul8265" class="social-link" target="_blank" rel="noopener" aria-label="Paul Kuo çš„ YouTube é »é“">â–¶ YouTube</a>
            <a href="https://www.facebook.com/guo.yao.lang.2025" class="social-link" target="_blank" rel="noopener" aria-label="Paul Kuo çš„ Facebook å€‹äººé é¢">ğŸ“˜ Facebook</a>
            <a href="https://www.instagram.com/zarqarwi" class="social-link" target="_blank" rel="noopener" aria-label="Paul Kuo çš„ Instagram å¸³è™Ÿ">ğŸ“· Instagram</a>
            <a href="https://bsky.app/profile/paulkuo.bsky.social" class="social-link" target="_blank" rel="noopener" aria-label="Paul Kuo çš„ Bluesky å¸³è™Ÿ">ğŸ¦‹ Bluesky</a>
          </div>
        </div>
        <div class="contact-form">
          <form id="contact-form"
                toolname="contact_paul_kuo"
                tooldescription="Send a direct message or inquiry to Paul Kuo regarding consulting, speaking, collaborations, or circular economy topics. Paul is based in Taiwan and speaks Chinese, English, and Japanese.">
            <div class="form-group">
              <label for="contact-name">å§“å</label>
              <input type="text" id="contact-name" name="name" placeholder="ä½ çš„åå­—" required autocomplete="name">
            </div>
            <div class="form-group">
              <label for="contact-email">Email</label>
              <input type="email" id="contact-email" name="email" placeholder="you@example.com" required autocomplete="email">
            </div>
            <div class="form-group">
              <label for="contact-message">è¨Šæ¯</label>
              <textarea id="contact-message" name="message" placeholder="æƒ³èŠä»€éº¼ï¼Ÿ"></textarea>
            </div>
            <button type="submit" class="btn-submit" id="contact-submit">é€å‡º</button>
            <div id="form-feedback" role="status" aria-live="polite" style="margin-top:12px;text-align:center;font-size:0.88rem;display:none;"></div>
          </form>
          <script>
            (function() {
              const form = document.getElementById('contact-form');
              const btn = document.getElementById('contact-submit');
              const feedback = document.getElementById('form-feedback');
              if (!form || !btn || !feedback) return;

              const originalText = btn.textContent;

              form.addEventListener('submit', function(e) {
                e.preventDefault();

                // Prevent double-click
                if (btn.disabled) return;

                const name = document.getElementById('contact-name').value.trim();
                const email = document.getElementById('contact-email').value.trim();
                const message = document.getElementById('contact-message').value.trim();

                // Validation
                if (!name || !email) {
                  feedback.style.display = 'block';
                  feedback.style.color = '#ff6b6b';
                  feedback.textContent = 'è«‹å¡«å¯«å§“åå’Œ Email';
                  return;
                }

                // Loading state: disable + spinner
                btn.disabled = true;
                btn.innerHTML = '<span class="btn-spinner" aria-hidden="true"></span> è™•ç†ä¸­...';
                feedback.style.display = 'none';

                // Build mailto URL and navigate
                var subject = encodeURIComponent('ä¾†è‡ª paulkuo.tw çš„è¨Šæ¯ â€” ' + name);
                var body = encodeURIComponent('å§“åï¼š' + name + '\nEmailï¼š' + email + '\n\n' + message);
                window.location.href = 'mailto:paul@lasaas.com?subject=' + subject + '&body=' + body;

                // Restore button + show success after brief delay
                setTimeout(function() {
                  btn.disabled = false;
                  btn.textContent = originalText;
                  feedback.style.display = 'block';
                  feedback.style.color = 'rgba(255,255,255,0.8)';
                  feedback.textContent = 'âœ… éƒµä»¶å·²é–‹å•Ÿï¼Œè«‹ç¢ºèªé€å‡ºã€‚è¬è¬ï¼';
                  setTimeout(function() { feedback.style.display = 'none'; }, 6000);
                }, 1200);
              });
            })();
          </script>
          <style>
            @keyframes contact-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
            .btn-submit:disabled { cursor: not-allowed; opacity: 0.6; pointer-events: none; }
            .btn-spinner {
              display: inline-block;
              width: 14px;
              height: 14px;
              border: 2px solid rgba(255,255,255,0.3);
              border-top-color: #fff;
              border-radius: 50%;
              animation: contact-spin 0.6s linear infinite;
              vertical-align: middle;
              margin-right: 4px;
            }
          </style>
        </div>
      </div>
    </div>
  </section>

</BaseLayout>
